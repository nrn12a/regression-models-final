# Nathan Neill, UNI: nn2401
# GLM Homework 5 R code

# Problem 1, parasite data
rm(list=ls())
parasite <- read.table("parasite.txt", header=T)
summary(parasite)
parasite$Area <- factor(parasite$Area)
parasite$Year <- factor(parasite$Year)

# get rid of null values
parasite <- subset(parasite, !is.na(Intensity))

library(MASS)

# fit a Poisson model with log link
# area, year, length as predictors
poisson_parasite <- glm(Intensity ~ Area + Length + Year,
                        data=parasite, family=poisson())
summary(poisson_parasite)

dev.resid.parasite <- resid(poisson_parasite)
pear.resid.parasite <- resid(poisson_parasite, type="pearson")


# plot residuals
plot(fitted(poisson_parasite), dev.resid.parasite, xlab="Fitted Intensity", 
     ylab="Deviance Residuals")


plot(fitted(poisson_parasite), pear.resid.parasite, xlab="Fitted Intensity", 
     ylab="Pearson Residuals")

# test goodness of fit, 1c
pchisq(deviance(poisson_parasite), df.residual(poisson_parasite),
       lower.tail=F)

pchisq(sum(pear.resid.parasite^2), df.residual(poisson_parasite),
       lower.tail=F)
anova(poisson_parasite, test="Chisq")


# build a zero inflated model
library(pscl)
parasite0 <- zeroinfl(Intensity ~ Area + Length + Year,
                      data=parasite, dist = "poisson")

summary(parasite0)

vuong(parasite0, poisson_parasite)



# Problem 2
dose <- rep(c("Low","High"), each=4)
cancer <- rep(rep(c("Present", "Absent"),each=2), times=2)
age <- rep(c("lessthan131","sacrificed"),times=4)
n <- c(4,0,26,14,7,7,16,14)
prob2 <- data.frame(n=n, dose=dose, cancer=cancer, age=age)
prob2




# Problem 3
type <- rep(c("collision","rollover"),each=8)
weight <- rep(rep(c("small","standard"),each=4), times=2)
ejected <- rep(rep(c("no","yes"),each=2), times=4)
severity <- rep(c("notsevere","severe"),time=8)
n <- c(350, 150, 26, 23, 1878, 1022, 111, 161, 60, 112, 19, 80, 148, 404, 22, 265)
prob3 <- data.frame(n=n, type=type, weight=weight, ejected=ejected, severity=severity)
prob3

# first attempt at saturated
three.full <- glm(n ~ type*weight*ejected*severity, 
                  family=poisson(), data=prob3)
summary(three.full)
anova(three.full, test="Chisq")


# models of uniform order
threeorder1 <- glm(n ~ type + weight + ejected + severity, family=poisson(), data=prob3)
summary(threeorder1)

threeorder2 <- glm(n ~ (type + weight + ejected + severity)^2, family=poisson(), data=prob3)
summary(threeorder2)

threeorder3 <- glm(n ~ (type + weight + ejected + severity)^3, family=poisson(), data=prob3)
summary(threeorder3)

threeorder4 <- glm(n ~ (type + weight + ejected + severity)^4, family=poisson(), data=prob3)
summary(threeorder4)


